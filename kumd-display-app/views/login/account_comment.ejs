<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
        <title>2021年度春のパネル展示会</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link rel='stylesheet' href='/stylesheets/style.css' />
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
        <!-- <link rel="stylesheet" href="/stylesheets/swiper-bundle.min.css"> -->
        <script src="/javascripts/jquery-3.5.1.min.js"></script>
    </head>
    <body class="container">
        <div class="accountComment">
            <h3>コメント確認</h3>
            <label for="">イラスト</label>
            <img src="" alt="">
            <label for="">コメント</label>
            <table class="table">
                <tr>
                    <th>時刻</th>
                    <td>コメント</td>
                </tr>
                <tr>
                    <th>09/22 10:12</th>
                    <td>めちゃくちゃよかった！gsdsdfggdgf</td>
                </tr>
                <tr>
                    <th>09/22 10:12</th>
                    <td>めちゃくちゃよかった！</td>
                </tr>
                <tr>
                    <th>09/22 10:12</th>
                    <td>生麦生米生卵隣の客はよく柿食う客だ</td>
                </tr>
            </table>
        </div>
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/8.4.3/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.4.3/firebase-storage.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-firestore.js"></script>
        <script src="https://www.gstatic.com/firebasejs/8.3.2/firebase-auth.js"></script>
        <script src="/javascripts/firebase_config.js"></script>
        <script>

var queryValue;

firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
        console.log("There's a user");
    } else {
        console.log("No user");
        location.href='/login';
    }
});

var submitButton = document.getElementById('submit-btn');
var deleteButton = document.getElementById('delete');

submitButton.addEventListener("click",()=>{
    console.log("click fileButton");
    const gradeValue = document.getElementById('grade-select').value;
    const sizeValue = document.getElementById('size-select').value;
    const pennameValue = document.getElementById('penname').value;
    const titleValue = document.getElementById('title').value;
    const captionValue = document.getElementById('caption').value;
    console.log("change_gradeValue",gradeValue);
    console.log("change_sizeValue",sizeValue);
    console.log("change_pennameValue",pennameValue);
    console.log("change_titleValue",titleValue);
    console.log("change_captionValue",captionValue);
    const uid = firebase.auth().currentUser.uid;
    const db = firebase.firestore();
    const imgsRef = db.collection('imgs').doc(uid+"-"+queryValue);
    //イラスト情報の保存(firestore)
    imgsRef.update({
            grade: gradeValue,
            size: sizeValue,
            penname: pennameValue,
            title: titleValue,
            caption: captionValue,
        })
        .then(() => {
            console.log("Imgs Data successfully changed!");
            location.href='/login/account';
        })
        .catch((error) => {
            console.error("Error changing Imgs Data: ", error);
        });
});

deleteButton.addEventListener("click",()=>{

});

function readInfo(imgsValue){
    const uid = firebase.auth().currentUser.uid;
    const imgsUid = `${uid}-${imgsValue}`
    var imgsData;
    const db = firebase.firestore();
    const userRef = db.collection('imgs').doc(imgsUid);
    userRef.get().then((doc)=>{
        if (doc.exists) {
            imgsData = doc.data();
            console.log("imgsData:", imgsData);
            writeInfo(imgsData);
            //readImg(imgsValue);
        } else {
            // doc.data() will be undefined in this case
            console.log("No such document!");
            location.href='/login/account';
        }
    }).catch((err)=>{
        console.log("Error getting Imgs Data:", err)
    })
}

function writeInfo(imgsData){
    var gradeElement = document.getElementById('grade-select');
    var sizeElement = document.getElementById('size-select');
    var pennameElement = document.getElementById('penname');
    var titleElement = document.getElementById('title');
    var captionElement = document.getElementById('caption');

    gradeElement.value = imgsData.grade;
    sizeElement.value = imgsData.size;
    pennameElement.value = imgsData.penname;
    titleElement.value = imgsData.title;
    captionElement.value = imgsData.caption;
}
function readImg(imgsValue){
    const image = document.querySelector('img');
    //ファイアーベースから画像を取得
    const storage = firebase.storage();
    var storageRef = storage.ref();
    storageRef.child('imgs/'+firebase.auth().currentUser.uid+"-"+imgsValue+".jpg").getDownloadURL().then(function(url) {
        image.src = url;
    }).catch((error) => {
        // Handle any errors
        console.log("err >>>",error);
    });
    //ファイアーベースから画像取得完了
}
        </script>
    </body>
</html>